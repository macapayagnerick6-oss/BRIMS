import{a as U}from"./chunk-EYL5QPK3.js";import{b as z,c as B,f as N,i as W,j as R,k as V,o as j}from"./chunk-KYS23DP7.js";import{f as D}from"./chunk-BRLNKSN4.js";import"./chunk-KPGMZ2XY.js";import{c as K}from"./chunk-DUWH3AKD.js";import{$a as n,Ea as P,Ia as S,Na as u,Qb as F,Rb as I,Sb as T,Vb as A,X as w,Y as O,Za as p,_a as a,ab as M,bb as L,cb as f,d as G,db as g,kb as E,lb as r,nb as h,ob as b,qb as C,rb as v,sb as y,ub as H,vb as k,xa as l}from"./chunk-PQPYQFLK.js";var c=G(U());var q=()=>["/staff/households"],J=i=>({"background-color":i}),Q=i=>({borderColor:i});function X(i,m){if(i&1&&(a(0,"p",30),r(1),n()),i&2){let e=g();l(),b(" ",e.missingCoordinatesCount," household",e.missingCoordinatesCount!==1?"s":""," have no coordinates yet and are not shown on the map. ")}}function Y(i,m){if(i&1){let e=L();a(0,"button",31),f("click",function(){w(e);let t=g();return O(t.clearFilters())}),r(1," Clear all "),n()}}function ee(i,m){if(i&1&&(a(0,"option",32),r(1),n()),i&2){let e=m.$implicit;p("value",e),l(),h(" ",e," ")}}function te(i,m){if(i&1&&(a(0,"option",32),r(1),n()),i&2){let e=m.$implicit;p("value",e.key),l(),h(" ",e.label," ")}}function oe(i,m){if(i&1&&(a(0,"option",32),r(1),n()),i&2){let e=m.$implicit;p("value",e.key),l(),h(" ",e.label," ")}}function ne(i,m){if(i&1&&(a(0,"div",39),M(1,"span",40),a(2,"span",41),r(3),n(),a(4,"span",42),r(5),n()()),i&2){let e=m.$implicit;l(),p("ngStyle",k(3,J,e.color)),l(2),h(" ",e.label," "),l(2),h(" ",e.count," ")}}function ie(i,m){if(i&1&&(a(0,"div",35)(1,"h3",36),r(2,"By status"),n(),a(3,"div",37),u(4,ne,6,5,"div",38),n()()),i&2){let e=g(2);l(4),p("ngForOf",e.statusLegend)}}function ae(i,m){if(i&1&&(a(0,"div",39),M(1,"span",43),a(2,"span",41),r(3),n(),a(4,"span",42),r(5),n()()),i&2){let e=m.$implicit;l(),p("ngStyle",k(3,Q,e.color)),l(2),h(" ",e.label," "),l(2),h(" ",e.count," ")}}function re(i,m){if(i&1&&(a(0,"div",35)(1,"h3",36),r(2,"By risk level"),n(),a(3,"div",37),u(4,ae,6,5,"div",38),n()()),i&2){let e=g(2);l(4),p("ngForOf",e.riskLegend)}}function le(i,m){if(i&1&&(a(0,"div",33),u(1,ie,5,1,"div",34)(2,re,5,1,"div",34),n()),i&2){let e=g();l(),p("ngIf",e.statusLegend.length),l(),p("ngIf",e.riskLegend.length)}}function se(i,m){if(i&1&&(a(0,"li",48)(1,"span",49),r(2),n(),a(3,"span",50),r(4),n()()),i&2){let e=m.$implicit;l(2),h(" ",e.householdId," "),l(2),b(" ",e.address," (",e.purok,") ")}}function de(i,m){if(i&1&&(a(0,"div",44)(1,"h3",45),r(2),n(),a(3,"ul",46),u(4,se,5,3,"li",47),n()()),i&2){let e=g();l(2),h(" Households not yet mapped (",e.missingHouseholds.length,") "),l(2),p("ngForOf",e.missingHouseholds)}}var fe=(()=>{class i{get totalHouseholdsCount(){return this.households.length}get mappedHouseholdsCount(){return this.households.filter(e=>typeof e.latitude=="number"&&typeof e.longitude=="number").length}get unmappedHouseholdsCount(){return this.households.filter(e=>typeof e.latitude!="number"||typeof e.longitude!="number").length}get hasLegend(){return this.statusLegend.length>0||this.riskLegend.length>0}get hasActiveFilters(){return!!(this.searchTerm||this.selectedPurok||this.selectedStatusKey||this.selectedRiskKey)}clearFilters(){this.searchTerm="",this.selectedPurok="",this.selectedStatusKey="",this.selectedRiskKey="",this.onFiltersChanged()}constructor(e){this.data=e,this.map=null,this.markersLayer=null,this.households=[],this.missingCoordinatesCount=0,this.searchTerm="",this.selectedPurok="",this.selectedStatusKey="",this.selectedRiskKey="",this.statusColorMap={active:"#16a34a",inactive:"#6b7280",relocated:"#f97316","4ps":"#2563eb",senior:"#f59e0b",pwd:"#a855f7"},this.riskColorMap={flood_prone:"#ef4444",fire_risk:"#f97316",normal:"#22c55e"},this.defaultCenter=[8.574,124.776],this.defaultZoom=16}ngOnInit(){this.data.householdsObservable.subscribe(e=>{this.households=e,this.updateMarkers()})}ngAfterViewInit(){this.initMap(),this.updateMarkers()}ngOnDestroy(){this.map&&(this.map.remove(),this.map=null)}initMap(){this.map||(this.map=c.map("household-map-container",{center:this.defaultCenter,zoom:this.defaultZoom}),c.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(this.map))}updateMarkers(){if(!this.map||!this.households)return;let e=this.getFilteredHouseholds();this.markersLayer?this.markersLayer.clearLayers():this.markersLayer=c.layerGroup().addTo(this.map);let o=[];this.missingCoordinatesCount=0;for(let t of e){let{latitude:s,longitude:d}=t;if(typeof s=="number"&&typeof d=="number"){let _=[s,d];o.push(_);let{color:Z,fillColor:$}=this.getMarkerColors(t),x=c.circleMarker(_,{radius:8,weight:2,color:Z,fillColor:$,fillOpacity:.9});x.bindPopup(this.buildPopupContent(t),{autoClose:!1,closeOnClick:!1}),x.addTo(this.markersLayer),x.openPopup()}else this.missingCoordinatesCount++}if(o.length&&this.map){let t=c.latLngBounds(o);this.map.fitBounds(t,{padding:[24,24]})}}onFiltersChanged(){this.updateMarkers()}get purokOptions(){let e=new Set;for(let o of this.households)o.purok&&e.add(o.purok);return Array.from(e).sort()}get statusOptions(){let e=new Set;for(let o of this.households)o.status&&e.add(o.status.toLowerCase());return Array.from(e).map(o=>({key:o,label:this.formatLabel(o)}))}get riskOptions(){let e=new Set;for(let o of this.households)o.riskLevel&&e.add(o.riskLevel.toLowerCase());return Array.from(e).map(o=>({key:o,label:this.formatLabel(o)}))}get statusLegend(){let e=new Map,o=this.getFilteredHouseholds();for(let t of o){if(!t.status)continue;let s=t.status.toLowerCase();e.set(s,(e.get(s)??0)+1)}return Array.from(e.entries()).map(([t,s])=>({key:t,label:this.formatLabel(t),color:this.statusColorMap[t]??"#2563eb",count:s}))}get riskLegend(){let e=new Map,o=this.getFilteredHouseholds();for(let t of o){if(!t.riskLevel)continue;let s=t.riskLevel.toLowerCase();e.set(s,(e.get(s)??0)+1)}return Array.from(e.entries()).map(([t,s])=>({key:t,label:this.formatLabel(t),color:this.riskColorMap[t]??"#22c55e",count:s}))}get missingHouseholds(){return this.getFilteredHouseholds().filter(e=>typeof e.latitude!="number"||typeof e.longitude!="number")}getFilteredHouseholds(){let e=[...this.households];if(this.searchTerm){let o=this.searchTerm.toLowerCase();e=e.filter(t=>{let s=t.members.find(_=>_.relationship==="Head")??t.members[0],d=s?s.name.toLowerCase():"";return t.householdId.toLowerCase().includes(o)||t.address.toLowerCase().includes(o)||d.includes(o)})}return this.selectedPurok&&(e=e.filter(o=>o.purok===this.selectedPurok)),this.selectedStatusKey&&(e=e.filter(o=>(o.status||"").toLowerCase()===this.selectedStatusKey)),this.selectedRiskKey&&(e=e.filter(o=>(o.riskLevel||"").toLowerCase()===this.selectedRiskKey)),this.missingCoordinatesCount=e.filter(o=>typeof o.latitude!="number"||typeof o.longitude!="number").length,e}getMarkerColors(e){let o=(e.status||"").toLowerCase(),t=(e.riskLevel||"").toLowerCase(),s=this.statusColorMap[o]??"#3b82f6";return{color:this.riskColorMap[t]??"#2563eb",fillColor:s}}formatLabel(e){return e.split(/[_\s]+/).map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}buildPopupContent(e){let o=e.members.find(_=>_.relationship==="Head")??e.members[0],t=o?o.name:"Unknown",s=e.status||"N/A",d=e.purok||"N/A";return`
      <div>
        <strong>${e.householdId}</strong><br/>
        Head: ${t}<br/>
        Address: ${e.address}<br/>
        Purok: ${d}<br/>
        Status: ${s}
      </div>
    `}static{this.\u0275fac=function(o){return new(o||i)(P(K))}}static{this.\u0275cmp=S({type:i,selectors:[["app-household-map"]],decls:72,vars:18,consts:[[1,"household-map-page"],[1,"page-header"],[1,"page-title"],[1,"btn","btn--outline",3,"routerLink"],[1,"household-map-layout","card"],[1,"household-map-layout__top"],[1,"household-map-layout__info"],[1,"household-map-layout__summary"],["class","household-map-layout__warning",4,"ngIf"],[1,"household-map-stats"],[1,"household-map-stat"],[1,"household-map-stat__label"],[1,"household-map-stat__value"],[1,"household-map-filters"],[1,"household-map-filters__header"],[1,"household-map-filters__title"],["type","button","class","household-map-filters__clear",3,"click",4,"ngIf"],[1,"household-map-filters__grid"],[1,"household-map-filter-group"],[1,"household-map-filter-group__label"],[1,"household-map-filter-group__icon"],[1,"household-map-filter-group__input-wrapper"],["type","text","placeholder","Household ID, head name, or address",1,"form-control","household-map-filter-group__input",3,"ngModelChange","ngModel"],[1,"form-control","household-map-filter-group__input",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"household-map-layout__body"],["class","household-map-legend",4,"ngIf"],["id","household-map-container","aria-label","Barangay household map",1,"household-map-container"],["class","household-map-missing",4,"ngIf"],[1,"household-map-layout__warning"],["type","button",1,"household-map-filters__clear",3,"click"],[3,"value"],[1,"household-map-legend"],["class","household-map-legend__group",4,"ngIf"],[1,"household-map-legend__group"],[1,"household-map-legend__title"],[1,"household-map-legend__items"],["class","household-map-legend__item",4,"ngFor","ngForOf"],[1,"household-map-legend__item"],[1,"household-map-legend__marker",3,"ngStyle"],[1,"household-map-legend__label"],[1,"household-map-legend__count"],[1,"household-map-legend__marker","household-map-legend__marker--bordered",3,"ngStyle"],[1,"household-map-missing"],[1,"household-map-missing__title"],[1,"household-map-missing__list"],["class","household-map-missing__item",4,"ngFor","ngForOf"],[1,"household-map-missing__item"],[1,"household-map-missing__id"],[1,"household-map-missing__address"]],template:function(o,t){o&1&&(a(0,"div",0)(1,"div",1)(2,"h1",2),r(3,"Household Map"),n(),a(4,"a",3),r(5," Back to List "),n()(),a(6,"div",4)(7,"div",5)(8,"div",6)(9,"p",7),r(10," Showing all households with known coordinates in the barangay. "),n(),u(11,X,2,2,"p",8),a(12,"div",9)(13,"div",10)(14,"div",11),r(15,"Total households"),n(),a(16,"div",12),r(17),n()(),a(18,"div",10)(19,"div",11),r(20,"Mapped on GIS"),n(),a(21,"div",12),r(22),n()(),a(23,"div",10)(24,"div",11),r(25,"Not yet mapped"),n(),a(26,"div",12),r(27),n()()()(),a(28,"div",13)(29,"div",14)(30,"h3",15),r(31,"Filters & Search"),n(),u(32,Y,2,0,"button",16),n(),a(33,"div",17)(34,"div",18)(35,"label",19)(36,"span",20),r(37,"\u{1F50D}"),n(),r(38," Search "),n(),a(39,"div",21)(40,"input",22),y("ngModelChange",function(d){return v(t.searchTerm,d)||(t.searchTerm=d),d}),f("ngModelChange",function(){return t.onFiltersChanged()}),n()()(),a(41,"div",18)(42,"label",19)(43,"span",20),r(44,"\u{1F4CD}"),n(),r(45," Purok "),n(),a(46,"select",23),y("ngModelChange",function(d){return v(t.selectedPurok,d)||(t.selectedPurok=d),d}),f("ngModelChange",function(){return t.onFiltersChanged()}),a(47,"option",24),r(48,"All Puroks"),n(),u(49,ee,2,2,"option",25),n()(),a(50,"div",18)(51,"label",19)(52,"span",20),r(53,"\u{1F4CB}"),n(),r(54," Status "),n(),a(55,"select",23),y("ngModelChange",function(d){return v(t.selectedStatusKey,d)||(t.selectedStatusKey=d),d}),f("ngModelChange",function(){return t.onFiltersChanged()}),a(56,"option",24),r(57,"All Statuses"),n(),u(58,te,2,2,"option",25),n()(),a(59,"div",18)(60,"label",19)(61,"span",20),r(62,"\u26A0\uFE0F"),n(),r(63," Risk Level "),n(),a(64,"select",23),y("ngModelChange",function(d){return v(t.selectedRiskKey,d)||(t.selectedRiskKey=d),d}),f("ngModelChange",function(){return t.onFiltersChanged()}),a(65,"option",24),r(66,"All Risk Levels"),n(),u(67,oe,2,2,"option",25),n()()()()(),a(68,"div",26),u(69,le,3,2,"div",27),M(70,"div",28),n(),u(71,de,5,2,"div",29),n()()),o&2&&(l(4),p("routerLink",H(17,q)),l(7),p("ngIf",t.missingCoordinatesCount>0),l(6),h(" ",t.totalHouseholdsCount," "),l(5),h(" ",t.mappedHouseholdsCount," "),l(5),h(" ",t.unmappedHouseholdsCount," "),l(5),p("ngIf",t.hasActiveFilters),l(8),C("ngModel",t.searchTerm),l(6),C("ngModel",t.selectedPurok),l(3),p("ngForOf",t.purokOptions),l(6),C("ngModel",t.selectedStatusKey),l(3),p("ngForOf",t.statusOptions),l(6),C("ngModel",t.selectedRiskKey),l(3),p("ngForOf",t.riskOptions),l(),E("household-map-layout__body--no-legend",!t.hasLegend),l(),p("ngIf",t.hasLegend),l(2),p("ngIf",t.missingHouseholds.length))},dependencies:[A,F,I,T,j,R,V,z,W,B,N,D],styles:[".household-map-page[_ngcontent-%COMP%]   .household-map-layout[_ngcontent-%COMP%]{margin-top:.5rem;display:flex;flex-direction:column;gap:1rem}.household-map-page[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{padding-right:0}.household-map-layout__top[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}@media(min-width:1024px){.household-map-layout__top[_ngcontent-%COMP%]{flex-direction:row;justify-content:space-between;align-items:flex-start}.household-map-layout__info[_ngcontent-%COMP%], .household-map-filters[_ngcontent-%COMP%]{flex:1 1 0;max-width:50%}.household-map-layout__top[_ngcontent-%COMP%]{gap:1.25rem}}.household-map-layout__summary[_ngcontent-%COMP%]{margin:0 0 .25rem;color:var(--color-text-muted);font-size:.95rem}.household-map-layout__warning[_ngcontent-%COMP%]{margin:0;font-size:.85rem;color:var(--color-warning)}.household-map-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem;margin-top:.75rem}.household-map-stat[_ngcontent-%COMP%]{padding:.6rem .9rem;border-radius:var(--radius);background-color:var(--color-bg-secondary);min-width:140px}.household-map-stat__label[_ngcontent-%COMP%]{font-size:.7rem;text-transform:uppercase;letter-spacing:.04em;color:var(--color-text-muted);margin-bottom:.25rem}.household-map-stat__value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--color-text)}.household-map-filters[_ngcontent-%COMP%]{padding:.75rem 1rem;background-color:var(--color-bg-secondary);border-radius:var(--radius);border:1px solid var(--color-border)}.household-map-filters__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;padding-bottom:.5rem;border-bottom:1px solid var(--color-border)}.household-map-filters__title[_ngcontent-%COMP%]{margin:0;font-size:.95rem;font-weight:600;color:var(--color-text)}.household-map-filters__clear[_ngcontent-%COMP%]{padding:.4rem .75rem;font-size:.8rem;font-weight:500;color:var(--color-primary);background:transparent;border:1px solid var(--color-primary);border-radius:var(--radius);cursor:pointer;transition:all .2s ease}.household-map-filters__clear[_ngcontent-%COMP%]:hover{background:var(--color-primary-bg)}.household-map-filters__clear[_ngcontent-%COMP%]:active{transform:scale(.98)}.household-map-filters__grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:flex-end}.household-map-filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;flex:1 1 200px;min-width:180px}.household-map-filter-group__label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;font-size:.8rem;font-weight:500;color:var(--color-text-muted);margin:0}.household-map-filter-group__icon[_ngcontent-%COMP%]{font-size:.9rem;line-height:1}.household-map-filter-group__input-wrapper[_ngcontent-%COMP%]{position:relative}.household-map-filter-group__input[_ngcontent-%COMP%]{width:100%;padding:.65rem .85rem;font-size:.9rem;border:1px solid var(--color-input-border);border-radius:var(--radius);background:var(--color-bg-input);color:var(--color-text-input);transition:border-color .2s ease,box-shadow .2s ease}.household-map-filter-group__input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px #2563eb1a}.household-map-filter-group__input[_ngcontent-%COMP%]::placeholder{color:var(--color-input-placeholder)}@media(max-width:768px){.household-map-filters__grid[_ngcontent-%COMP%]{flex-direction:column}.household-map-filter-group[_ngcontent-%COMP%]{flex:1 1 100%;min-width:100%}.household-map-filters__header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}.household-map-filters__clear[_ngcontent-%COMP%]{width:100%}}.household-map-layout__body[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1.2fr) minmax(0,3fr);gap:1rem;align-items:stretch}.household-map-layout__body--no-legend[_ngcontent-%COMP%]{grid-template-columns:minmax(0,1fr)}.household-map-legend[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.household-map-legend__group[_ngcontent-%COMP%]{padding:.75rem 1rem;border-radius:var(--radius);background-color:var(--color-bg-secondary)}.household-map-legend__title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.9rem;font-weight:600;color:var(--color-text)}.household-map-legend__items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.household-map-legend__item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.85rem;color:var(--color-text-muted)}.household-map-legend__marker[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:999px;flex-shrink:0}.household-map-legend__marker--bordered[_ngcontent-%COMP%]{background-color:transparent;border:3px solid var(--color-primary)}.household-map-legend__label[_ngcontent-%COMP%]{flex:1}.household-map-legend__count[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text)}.household-map-container[_ngcontent-%COMP%]{width:100%;height:calc(100vh - 320px);min-height:360px;border-radius:var(--radius-lg);overflow:hidden}.household-map-missing[_ngcontent-%COMP%]{border-top:1px solid var(--color-border);padding-top:.75rem}.household-map-missing__title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.9rem;font-weight:600}.household-map-missing__list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.35rem}.household-map-missing__item[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;font-size:.85rem;color:var(--color-text-muted)}.household-map-missing__id[_ngcontent-%COMP%]{font-weight:600}.household-map-missing__address[_ngcontent-%COMP%]{opacity:.9}@media(max-width:768px){.household-map-layout__body[_ngcontent-%COMP%]{grid-template-columns:minmax(0,1fr)}.household-map-legend[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;gap:.75rem}.household-map-legend__group[_ngcontent-%COMP%]{flex:1 1 160px}.household-map-container[_ngcontent-%COMP%]{height:calc(100vh - 320px)}}"]})}}return i})();export{fe as HouseholdMapComponent};
