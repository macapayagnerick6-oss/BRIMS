import{j as S,k as L,o as E}from"./chunk-KYS23DP7.js";import{b as P}from"./chunk-DUWH3AKD.js";import{$a as n,Cb as w,Ea as x,Ia as C,Sa as _,Ta as y,Ua as M,Vb as O,Xa as u,Ya as f,Za as p,_a as t,cb as b,db as v,ha as m,lb as a,mb as g,nb as h,xa as r}from"./chunk-PQPYQFLK.js";var T=(o,d)=>d.value,A=(o,d)=>d.id;function k(o,d){if(o&1&&(t(0,"option",7),a(1),n()),o&2){let e=d.$implicit;p("value",e.value),r(),g(e.label)}}function D(o,d){o&1&&(t(0,"p",12),a(1,"No audit log entries match your filters."),n())}function N(o,d){if(o&1&&(t(0,"tr")(1,"td",14),a(2),n(),t(3,"td",15),a(4),n(),t(5,"td")(6,"span",16),a(7),n()(),t(8,"td",17),a(9),n(),t(10,"td",18),a(11),n()()),o&2){let e=d.$implicit,i=v(2);r(2),g(i.formatDate(e.timestamp)),r(2),h(" ",e.userName||e.userEmail||"\u2014"," "),r(2),_("data-category",e.category),r(),h(" ",i.categoryLabel(e.category)," "),r(2),g(e.action),r(2),g(e.details||e.entityName||"\u2014")}}function z(o,d){if(o&1&&(t(0,"table",13)(1,"thead")(2,"tr")(3,"th"),a(4,"Date & Time"),n(),t(5,"th"),a(6,"User"),n(),t(7,"th"),a(8,"Category"),n(),t(9,"th"),a(10,"Action"),n(),t(11,"th"),a(12,"Details"),n()()(),t(13,"tbody"),u(14,N,12,6,"tr",null,A),n()()),o&2){let e=v();r(14),f(e.filteredLogs())}}var H=(()=>{class o{constructor(e){this.audit=e,this.logs=m([]),this.categoryFilter=m(""),this.searchText=m(""),this.filteredLogs=w(()=>{let i=this.logs(),l=this.categoryFilter().toLowerCase(),s=this.searchText().trim().toLowerCase();return l&&(i=i.filter(c=>c.category.toLowerCase()===l)),s&&(i=i.filter(c=>c.action.toLowerCase().includes(s)||c.userName?.toLowerCase().includes(s)||c.userEmail?.toLowerCase().includes(s)||c.details?.toLowerCase().includes(s)||c.entityName?.toLowerCase().includes(s))),i}),this.categories=[{value:"",label:"All categories"},{value:"auth",label:"Auth"},{value:"resident",label:"Resident"},{value:"household",label:"Household"},{value:"user",label:"User"},{value:"request",label:"Request"},{value:"system",label:"System"}]}ngOnInit(){this.logs.set(this.audit.getLogs())}onCategoryChange(e){this.categoryFilter.set(e)}onSearchInput(e){this.searchText.set(e)}formatDate(e){return new Date(e).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}categoryLabel(e){let i=this.categories.find(l=>l.value===e);return i?i.label:e}static{this.\u0275fac=function(i){return new(i||o)(x(P))}}static{this.\u0275cmp=C({type:o,selectors:[["app-audit-log"]],decls:19,vars:3,consts:[[1,"audit-log-page"],[1,"page-title"],[1,"page-description"],[1,"filters","card"],[1,"filters-row"],["for","category",1,"filter-label"],["id","category",1,"filter-select",3,"change","value"],[3,"value"],["for","search",1,"filter-label"],["id","search","type","text","placeholder","Action, user, details...",1,"filter-input",3,"input","value"],[1,"card","table-card"],[1,"table-wrapper"],[1,"empty-message"],[1,"table"],[1,"col-date"],[1,"col-user"],[1,"badge"],[1,"col-action"],[1,"col-details"]],template:function(i,l){i&1&&(t(0,"div",0)(1,"h1",1),a(2,"Audit Log"),n(),t(3,"p",2),a(4,"View system activity: logins, data changes, and user actions."),n(),t(5,"div",3)(6,"div",4)(7,"label",5),a(8,"Category"),n(),t(9,"select",6),b("change",function(c){return l.onCategoryChange(c.target.value)}),u(10,k,2,2,"option",7,T),n(),t(12,"label",8),a(13,"Search"),n(),t(14,"input",9),b("input",function(c){return l.onSearchInput(c.target.value)}),n()()(),t(15,"div",10)(16,"div",11),y(17,D,2,0,"p",12)(18,z,16,0,"table",13),n()()()),i&2&&(r(9),p("value",l.categoryFilter()),r(),f(l.categories),r(4),p("value",l.searchText()),r(3),M(l.filteredLogs().length===0?17:18))},dependencies:[O,E,S,L],styles:[".audit-log-page[_ngcontent-%COMP%]{width:100%}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin:0 0 .5rem}.page-description[_ngcontent-%COMP%]{color:var(--color-text-muted);font-size:.9375rem;margin:0 0 1.5rem}.filters[_ngcontent-%COMP%]{margin-bottom:1.5rem}.filters-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:1rem}.filter-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-muted)}.filter-select[_ngcontent-%COMP%]{padding:8px 12px;border-radius:var(--radius-md, 8px);border:1px solid var(--color-border);background:var(--color-bg);color:var(--color-text);font-size:.9375rem;min-width:160px}.filter-input[_ngcontent-%COMP%]{padding:8px 12px;border-radius:var(--radius-md, 8px);border:1px solid var(--color-border);background:var(--color-bg);color:var(--color-text);font-size:.9375rem;min-width:200px;flex:1}.table-card[_ngcontent-%COMP%]{overflow:hidden}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.empty-message[_ngcontent-%COMP%]{padding:2rem;text-align:center;color:var(--color-text-muted)}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;min-width:640px}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;text-align:left;border-bottom:1px solid var(--color-border)}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text-muted);font-size:.875rem;background:var(--color-bg)}.table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:var(--color-bg)}.col-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:.875rem}.col-user[_ngcontent-%COMP%]{max-width:180px;overflow:hidden;text-overflow:ellipsis}.col-action[_ngcontent-%COMP%]{font-weight:500}.col-details[_ngcontent-%COMP%]{max-width:280px;overflow:hidden;text-overflow:ellipsis;color:var(--color-text-muted);font-size:.9375rem}.badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:600;text-transform:capitalize}.badge[data-category=auth][_ngcontent-%COMP%]{background:var(--color-primary-bg, #eef2ff);color:var(--color-primary, #2563eb)}.badge[data-category=resident][_ngcontent-%COMP%]{background:var(--color-success-bg, #ecfdf5);color:var(--color-success, #059669)}.badge[data-category=household][_ngcontent-%COMP%]{background:#fef3c7;color:#b45309}.badge[data-category=user][_ngcontent-%COMP%]{background:#e0e7ff;color:#4f46e5}.badge[data-category=request][_ngcontent-%COMP%]{background:#fce7f3;color:#be185d}.badge[data-category=system][_ngcontent-%COMP%]{background:var(--color-bg);color:var(--color-text-muted)}"]})}}return o})();export{H as AuditLogComponent};
