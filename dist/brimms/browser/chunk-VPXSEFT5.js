import{a as D}from"./chunk-OCKJNETE.js";import{a as L}from"./chunk-6RFJ52Y7.js";import{b as j,c as N,d as R,e as W,f as z,g as F,o as X}from"./chunk-KYS23DP7.js";import{a as V}from"./chunk-KPGMZ2XY.js";import{c as I}from"./chunk-DUWH3AKD.js";import{$a as s,Ea as w,Ia as P,N as A,Na as b,Rb as k,S as T,Sa as E,Vb as O,X as p,Y as g,Za as m,_a as a,bb as x,cb as u,db as c,ib as B,kb as S,lb as l,nb as f,qb as v,rb as C,sb as M,xa as r}from"./chunk-PQPYQFLK.js";var U=(()=>{class o{constructor(){this.http=T(V),this.apiBaseUrl="http://localhost:4000"}sendSms(e){return this.http.post(`${this.apiBaseUrl}/api/notifications/sms`,e)}sendBulkSms(e){return this.http.post(`${this.apiBaseUrl}/api/notifications/sms/bulk`,e)}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275prov=A({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function K(o,h){if(o&1){let e=x();a(0,"div",17)(1,"label",22),l(2,"Recipient phone number"),s(),a(3,"input",23),M("ngModelChange",function(t){p(e);let i=c(2);return C(i.phone,t)||(i.phone=t),g(t)}),s()()}if(o&2){let e=c(2);r(3),v("ngModel",e.phone),m("disabled",e.isSending)}}function Q(o,h){o&1&&(a(0,"div",24),l(1," SMS messages longer than 160 characters may be split into multiple parts depending on your provider. "),s())}function Y(o,h){if(o&1&&(a(0,"div",24),l(1),s()),o&2){let e=c(2);r(),f(" This will send the message to all residents with a contact number (",e.smsBroadcastCount,"). ")}}function Z(o,h){if(o&1){let e=x();a(0,"section",10)(1,"h1",11),l(2,"SMS Notifications"),s(),a(3,"p",12),l(4," Send an SMS notification to a single resident or broadcast to all residents with a contact number. "),s(),a(5,"div",13)(6,"button",14),u("click",function(){p(e);let t=c();return g(t.broadcastSmsToAllResidents=!1)}),l(7," Single recipient "),s(),a(8,"button",14),u("click",function(){p(e);let t=c();return g(t.broadcastSmsToAllResidents=!0)}),l(9),s()(),a(10,"form",15),u("ngSubmit",function(){p(e);let t=c();return g(t.sendSms())}),b(11,K,4,2,"div",16),a(12,"div",17)(13,"label",18),l(14,"Message"),s(),a(15,"textarea",19),M("ngModelChange",function(t){p(e);let i=c();return C(i.message,t)||(i.message=t),g(t)}),s(),b(16,Q,2,0,"div",20)(17,Y,2,1,"div",20),s(),a(18,"button",21),l(19),s()()()}if(o&2){let e=c();r(6),S("active",!e.broadcastSmsToAllResidents),r(2),S("active",e.broadcastSmsToAllResidents),r(),f(" All residents (",e.smsBroadcastCount,") "),r(2),m("ngIf",!e.broadcastSmsToAllResidents),r(4),v("ngModel",e.message),m("disabled",e.isSending),r(),m("ngIf",!e.broadcastSmsToAllResidents),r(),m("ngIf",e.broadcastSmsToAllResidents),r(),m("disabled",e.isSending),r(),f(" ",e.isSending?"Sending\u2026":"Send SMS"," ")}}function $(o,h){if(o&1){let e=x();a(0,"div",17)(1,"label",36),l(2,"Recipient email address"),s(),a(3,"input",37),M("ngModelChange",function(t){p(e);let i=c(2);return C(i.email,t)||(i.email=t),g(t)}),s()()}if(o&2){let e=c(2);r(3),v("ngModel",e.email),m("disabled",e.isSendingEmail)}}function ee(o,h){if(o&1){let e=x();a(0,"div",24),l(1),a(2,"button",38),u("click",function(){p(e);let t=c(2);return g(t.clearEmailAttachment())}),l(3,"Remove"),s()()}if(o&2){let e=c(2);r(),f(" Attached: ",e.emailAttachmentName," ")}}function te(o,h){if(o&1&&(a(0,"div",24),l(1),s()),o&2){let e=c(2);r(),f(" This will send the email to all residents with an email address (",e.emailBroadcastCount,"). ")}}function ie(o,h){if(o&1){let e=x();a(0,"section",25)(1,"h2",26),l(2,"Email Notifications"),s(),a(3,"p",27),l(4," Send an email notification to a single resident or broadcast to all residents with an email address. "),s(),a(5,"div",13)(6,"button",14),u("click",function(){p(e);let t=c();return g(t.broadcastEmailToAllResidents=!1)}),l(7," Single recipient "),s(),a(8,"button",14),u("click",function(){p(e);let t=c();return g(t.broadcastEmailToAllResidents=!0)}),l(9),s()(),a(10,"form",28),u("ngSubmit",function(){p(e);let t=c();return g(t.sendEmail())}),b(11,$,4,2,"div",16),a(12,"div",17)(13,"label",29),l(14,"Subject"),s(),a(15,"input",30),M("ngModelChange",function(t){p(e);let i=c();return C(i.subject,t)||(i.subject=t),g(t)}),s()(),a(16,"div",17)(17,"label",31),l(18,"Message"),s(),a(19,"div",32)(20,"textarea",33),M("ngModelChange",function(t){p(e);let i=c();return C(i.emailMessage,t)||(i.emailMessage=t),g(t)}),s(),a(21,"input",34,0),u("change",function(t){p(e);let i=c();return g(i.onEmailFileSelected(t))}),s(),a(23,"button",35),u("click",function(){p(e);let t=B(22);return g(t.click())}),l(24," \u{1F4CE} "),s()(),b(25,ee,4,1,"div",20),s(),b(26,te,2,1,"div",20),a(27,"button",21),l(28),s()()()}if(o&2){let e=c();r(6),S("active",!e.broadcastEmailToAllResidents),r(2),S("active",e.broadcastEmailToAllResidents),r(),f(" All residents (",e.emailBroadcastCount,") "),r(2),m("ngIf",!e.broadcastEmailToAllResidents),r(4),v("ngModel",e.subject),m("disabled",e.isSendingEmail),r(5),v("ngModel",e.emailMessage),m("disabled",e.isSendingEmail),r(),m("disabled",e.isSendingEmail),r(2),m("disabled",e.isSendingEmail),r(2),m("ngIf",e.emailAttachmentName),r(),m("ngIf",e.broadcastEmailToAllResidents),r(),m("disabled",e.isSendingEmail),r(),f(" ",e.isSendingEmail?"Sending\u2026":"Send Email"," ")}}var ge=(()=>{class o{constructor(e,n,t,i){this.sms=e,this.emailService=n,this.notifications=t,this.data=i,this.activeTab="sms",this.phone="",this.message="",this.isSending=!1,this.email="",this.subject="",this.emailMessage="",this.isSendingEmail=!1,this.emailAttachmentBase64=null,this.emailAttachmentName=null,this.emailAttachmentMimeType=null,this.broadcastSmsToAllResidents=!1,this.broadcastEmailToAllResidents=!1}setActiveTab(e){this.activeTab=e}get smsBroadcastCount(){return this.data.residents.filter(e=>!!e.contact?.trim()).length}get emailBroadcastCount(){return this.data.residents.filter(e=>!!e.email?.trim()).length}onEmailFileSelected(e){let t=e.target.files?.[0];if(!t){this.emailAttachmentBase64=null,this.emailAttachmentName=null,this.emailAttachmentMimeType=null;return}let i=new FileReader;i.onload=()=>{let d=i.result,_=d.split(",")[1]||d;this.emailAttachmentBase64=_,this.emailAttachmentName=t.name,this.emailAttachmentMimeType=t.type||null},i.readAsDataURL(t)}clearEmailAttachment(){this.emailAttachmentBase64=null,this.emailAttachmentName=null,this.emailAttachmentMimeType=null}sendSms(){let e=this.message.trim();if(this.isSending=!0,this.broadcastSmsToAllResidents){if(!e){this.notifications.warning("Please enter a message to broadcast.","Missing information"),this.isSending=!1;return}let n=this.data.residents.map(t=>t.contact?.trim()).filter(t=>!!t);if(!n.length){this.notifications.warning("No residents with contact numbers found.","No recipients"),this.isSending=!1;return}this.sms.sendBulkSms({recipients:n,message:e}).subscribe({next:t=>{if(t.success){let i=t.results.filter(y=>y.success).length,d=t.results.length-i,_=d>0?`SMS sent to ${i} resident(s). ${d} failed.`:`SMS sent to ${i} resident(s).`;this.notifications.success(_,"SMS Broadcast"),this.message=""}else this.notifications.error(t.results?.length?"Some SMS messages failed.":"Failed to send SMS broadcast.","SMS Error")},error:t=>{console.error("SMS broadcast error",t),this.notifications.error("An error occurred while sending SMS broadcast.","SMS Error")},complete:()=>{this.isSending=!1}})}else{let n=this.phone.trim();if(!n||!e){this.notifications.warning("Please enter both phone number and message.","Missing information"),this.isSending=!1;return}this.sms.sendSms({to:n,message:e}).subscribe({next:t=>{t.success?(this.notifications.success("SMS sent successfully.","SMS Notification"),this.phone="",this.message=""):this.notifications.error(t.error||"Failed to send SMS.","SMS Error")},error:t=>{console.error("SMS send error",t),this.notifications.error("An error occurred while sending SMS.","SMS Error")},complete:()=>{this.isSending=!1}})}}sendEmail(){let e=this.email.trim(),n=this.subject.trim(),t=this.emailMessage.trim();if(this.isSendingEmail=!0,this.broadcastEmailToAllResidents){if(!n||!t){this.notifications.warning("Please enter subject and message to broadcast.","Missing information"),this.isSendingEmail=!1;return}let i=this.data.residents.map(d=>d.email?.trim()).filter(d=>!!d);if(!i.length){this.notifications.warning("No residents with email addresses found.","No recipients"),this.isSendingEmail=!1;return}this.emailService.sendBulkEmail({recipients:i,subject:n,message:t,attachmentName:this.emailAttachmentName||void 0,attachmentContent:this.emailAttachmentBase64||void 0,attachmentMimeType:this.emailAttachmentMimeType||void 0}).subscribe({next:d=>{if(d.success){let _=d.results.filter(H=>H.success).length,y=d.results.length-_,G=y>0?`Email sent to ${_} resident(s). ${y} failed.`:`Email sent to ${_} resident(s).`;this.notifications.success(G,"Email Broadcast"),this.subject="",this.emailMessage=""}else this.notifications.error(d.results?.length?"Some emails failed.":"Failed to send email broadcast.","Email Error")},error:d=>{console.error("Email broadcast error",d),this.notifications.error("An error occurred while sending email broadcast.","Email Error")},complete:()=>{this.isSendingEmail=!1}})}else{if(!e||!n||!t){this.notifications.warning("Please enter email, subject, and message.","Missing information"),this.isSendingEmail=!1;return}this.emailService.sendEmail({to:e,subject:n,message:t,attachmentName:this.emailAttachmentName||void 0,attachmentContent:this.emailAttachmentBase64||void 0,attachmentMimeType:this.emailAttachmentMimeType||void 0}).subscribe({next:i=>{i.success?(this.notifications.success("Email sent successfully.","Email Notification"),this.email="",this.subject="",this.emailMessage=""):this.notifications.error(i.error||"Failed to send email.","Email Error")},error:i=>{console.error("Email send error",i),this.notifications.error("An error occurred while sending email.","Email Error")},complete:()=>{this.isSendingEmail=!1}})}}static{this.\u0275fac=function(n){return new(n||o)(w(U),w(D),w(L),w(I))}}static{this.\u0275cmp=P({type:o,selectors:[["app-admin-sms-broadcast"]],decls:13,vars:8,consts:[["emailAttachmentInput",""],[1,"notifications-page"],[1,"page-header"],[1,"page-title"],[1,"tabs-wrapper"],["role","tablist",1,"tabs"],["type","button","role","tab",1,"tab-button",3,"click"],[1,"notifications-broadcast"],["class","sms-broadcast",4,"ngIf"],["class","email-broadcast",4,"ngIf"],[1,"sms-broadcast"],[1,"sms-broadcast__title"],[1,"sms-broadcast__subtitle"],[1,"recipient-toggle"],["type","button",1,"recipient-toggle__button",3,"click"],[1,"sms-broadcast__form",3,"ngSubmit"],["class","form-field",4,"ngIf"],[1,"form-field"],["for","message",1,"form-label"],["id","message","name","message","rows","4","placeholder","Type your SMS notification here...",1,"form-textarea",3,"ngModelChange","ngModel","disabled"],["class","form-help",4,"ngIf"],["type","submit",1,"btn","btn--primary",3,"disabled"],["for","phone",1,"form-label"],["id","phone","name","phone","type","tel","placeholder","+63 9XXXXXXXXX",1,"form-input",3,"ngModelChange","ngModel","disabled"],[1,"form-help"],[1,"email-broadcast"],[1,"email-broadcast__title"],[1,"email-broadcast__subtitle"],[1,"email-broadcast__form",3,"ngSubmit"],["for","subject",1,"form-label"],["id","subject","name","subject","type","text","placeholder","Subject line",1,"form-input",3,"ngModelChange","ngModel","disabled"],["for","emailMessage",1,"form-label"],[1,"textarea-with-attachment"],["id","emailMessage","name","emailMessage","rows","5","placeholder","Type your email message here...",1,"form-textarea",3,"ngModelChange","ngModel","disabled"],["id","emailAttachment","name","emailAttachment","type","file",2,"display","none",3,"change","disabled"],["type","button","aria-label","Attach file",1,"attachment-button",3,"click","disabled"],["for","email",1,"form-label"],["id","email","name","email","type","email","placeholder","resident@example.com",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","button",1,"link-button",3,"click"]],template:function(n,t){n&1&&(a(0,"div",1)(1,"div",2)(2,"h1",3),l(3,"Resident Notifications"),s()(),a(4,"div",4)(5,"nav",5)(6,"button",6),u("click",function(){return t.setActiveTab("sms")}),l(7," SMS "),s(),a(8,"button",6),u("click",function(){return t.setActiveTab("email")}),l(9," Email "),s()()(),a(10,"div",7),b(11,Z,20,12,"section",8)(12,ie,29,16,"section",9),s()()),n&2&&(r(6),S("active",t.activeTab==="sms"),E("aria-selected",t.activeTab==="sms"),r(2),S("active",t.activeTab==="email"),E("aria-selected",t.activeTab==="email"),r(3),m("ngIf",t.activeTab==="sms"),r(),m("ngIf",t.activeTab==="email"))},dependencies:[O,k,X,F,j,N,R,z,W],styles:[".notifications-page[_ngcontent-%COMP%]{width:100%}.page-header[_ngcontent-%COMP%]{margin-bottom:1rem}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600;color:var(--color-text)}.tabs-wrapper[_ngcontent-%COMP%]{margin-bottom:1.5rem}.tabs[_ngcontent-%COMP%]{display:inline-flex;gap:0;padding:6px;background:var(--color-bg);border-radius:var(--radius-lg);border:1px solid var(--color-border);box-shadow:0 1px 3px #0000000f;width:100%}.tabs[_ngcontent-%COMP%]   .tab-button[_ngcontent-%COMP%]{flex:1;min-width:0;padding:12px 24px;background:transparent;border:none;border-radius:calc(var(--radius-lg) - 4px);font-weight:500;font-size:.9375rem;color:var(--color-text-muted);cursor:pointer;transition:color .2s ease,background .2s ease,box-shadow .2s ease;white-space:nowrap}.tabs[_ngcontent-%COMP%]   .tab-button[_ngcontent-%COMP%]:hover:not(.active){color:var(--color-text);background:#0000000a}.tabs[_ngcontent-%COMP%]   .tab-button.active[_ngcontent-%COMP%]{color:#fff;background:var(--color-primary);box-shadow:0 2px 8px #2563eb59}.notifications-broadcast[_ngcontent-%COMP%]{max-width:640px;margin:0 auto;padding:0 1.25rem 1.5rem}.recipient-toggle[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:0 auto 1rem;max-width:320px;width:100%;padding:4px;background:var(--color-bg);border-radius:var(--radius-lg);border:1px solid var(--color-border);box-shadow:0 1px 3px #0000000a}.recipient-toggle__button[_ngcontent-%COMP%]{min-width:0;padding:8px 18px;background:transparent;border:none;border-radius:calc(var(--radius-lg) - 4px);font-weight:500;font-size:.875rem;color:var(--color-text-muted);cursor:pointer;transition:color .2s ease,background .2s ease,box-shadow .2s ease;white-space:nowrap}.recipient-toggle__button[_ngcontent-%COMP%]:hover:not(.active){color:var(--color-text);background:#0000000a}.recipient-toggle__button.active[_ngcontent-%COMP%]{color:#fff;background:var(--color-primary);box-shadow:0 2px 8px #2563eb59}.sms-broadcast[_ngcontent-%COMP%]{max-width:640px;margin:0 auto;padding:1.5rem 1.25rem}.sms-broadcast__title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:var(--color-text)}.sms-broadcast__subtitle[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--color-text-muted);font-size:.95rem}.email-broadcast__title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.35rem;font-weight:700;color:var(--color-text)}.email-broadcast__subtitle[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--color-text-muted);font-size:.95rem}.email-broadcast__form[_ngcontent-%COMP%], .sms-broadcast__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.form-label[_ngcontent-%COMP%]{font-weight:500;color:var(--color-text)}.form-input[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{border-radius:var(--radius);border:1px solid var(--color-border);padding:.5rem .75rem;font-size:.95rem;background-color:var(--color-bg);color:var(--color-text)}.form-input[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 1px var(--color-primary-soft)}.form-textarea[_ngcontent-%COMP%]{resize:vertical}.form-help[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-text-muted)}.textarea-with-attachment[_ngcontent-%COMP%]{position:relative}.textarea-with-attachment[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]{width:100%;display:block;padding-right:2.5rem}.attachment-button[_ngcontent-%COMP%]{position:absolute;right:.5rem;bottom:.5rem;width:32px;height:32px;border-radius:999px;border:none;background:transparent;color:var(--color-text);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.1rem;transition:background .15s ease,color .15s ease}.attachment-button[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--color-text);color:var(--color-bg)}.link-button[_ngcontent-%COMP%]{margin-left:.5rem;padding:0;border:none;background:transparent;color:var(--color-primary);cursor:pointer;font-size:.8rem}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.6rem 1.25rem;border-radius:999px;border:none;font-weight:600;cursor:pointer;font-size:.95rem}.btn--primary[_ngcontent-%COMP%]{background-color:var(--color-primary);color:#fff}.btn--primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:default}"]})}}return o})();export{ge as AdminSmsBroadcastComponent};
