import{a as oe}from"./chunk-EYL5QPK3.js";import{b as q,c as D,d as j,e as Z,f as G,g as $,i as J,j as K,k as Q,n as U,o as X}from"./chunk-KYS23DP7.js";import{e as W,f as z}from"./chunk-BRLNKSN4.js";import"./chunk-KPGMZ2XY.js";import{c as B}from"./chunk-DUWH3AKD.js";import{$a as n,Ea as O,Ia as R,Na as A,Rb as N,Ta as w,Ua as P,Va as T,Vb as V,Wa as L,X as M,Xa as v,Y as x,Ya as S,Za as u,_a as t,ab as F,bb as y,cb as p,d as ne,db as g,lb as i,mb as I,nb as k,pb as H,qb as f,rb as _,sb as b,xa as a}from"./chunk-PQPYQFLK.js";var C=ne(oe());var Y=(r,m)=>m.id;function ie(r,m){if(r&1){let e=y();t(0,"div",35)(1,"span"),i(2),n(),t(3,"span"),i(4),n(),t(5,"button",29),p("click",function(){M(e);let o=g();return x(o.clearLocation())}),i(6," Clear location "),n()()}if(r&2){let e=g();a(2),k("Lat: ",e.latitude),a(2),k("Lng: ",e.longitude)}}function re(r,m){if(r&1&&(t(0,"option",25),i(1),n()),r&2){let e=m.$implicit;u("value",e.id),a(),H(" ",e.residentId," - ",e.name," (",e.age,", ",e.gender,") ")}}function de(r,m){r&1&&(t(0,"p",26),i(1," No available residents. All residents are already assigned to households. "),t(2,"a",36),i(3,"Add a new resident first"),n(),i(4,". "),n())}function ae(r,m){if(r&1&&(t(0,"option",25),i(1),n()),r&2){let e=m.$implicit;u("value",e.id),a(),H(" ",e.residentId," - ",e.name," (",e.age,", ",e.gender,") ")}}function le(r,m){if(r&1&&(t(0,"option",25),i(1),n()),r&2){let e=m.$implicit;u("value",e),a(),I(e)}}function se(r,m){if(r&1){let e=y();t(0,"div",28)(1,"div",37)(2,"label"),i(3,"Resident"),n(),t(4,"select",38),b("ngModelChange",function(o){let l=M(e).$implicit;return _(l.residentId,o)||(l.residentId=o),x(o)}),t(5,"option",15),i(6,"Select resident"),n(),v(7,ae,2,5,"option",25,Y),n()(),t(9,"div",39)(10,"label"),i(11,"Relationship"),n(),t(12,"select",38),b("ngModelChange",function(o){let l=M(e).$implicit;return _(l.relationship,o)||(l.relationship=o),x(o)}),t(13,"option",15),i(14,"Select relationship"),n(),v(15,le,2,2,"option",25,L),n()(),t(17,"div",40)(18,"label"),i(19,"\xA0"),n(),t(20,"button",41),p("click",function(){let o=M(e).$index,l=g();return x(l.removeMemberRow(o))}),i(21,"Remove"),n()()()}if(r&2){let e=m.$implicit,d=m.$index,o=g();a(4),f("ngModel",e.residentId),u("name","memberResident"+d),a(3),S(o.getAvailableResidentsForMember(d)),a(5),f("ngModel",e.relationship),u("name","memberRelationship"+d),a(3),S(o.RELATIONSHIP_OPTIONS)}}function me(r,m){if(r&1&&(t(0,"div",30),i(1),n()),r&2){let e=g();a(),I(e.error)}}function ce(r,m){r&1&&(t(0,"div",31),i(1,"Household added successfully! Redirecting to households list..."),n())}var xe=(()=>{class r{constructor(e,d){this.data=e,this.router=d,this.household={address:"",purok:"",headId:""},this.latitude=null,this.longitude=null,this.map=null,this.marker=null,this.defaultCenter=[8.574,124.776],this.defaultZoom=17,this.selectedHeadResidentId="",this.additionalMembers=[],this.submitted=!1,this.error="",this.RELATIONSHIP_OPTIONS=["Spouse","Father","Mother","Son","Daughter","Brother","Sister","Grandfather","Grandmother","Other"]}get availableResidents(){let e=new Set;return this.data.households.forEach(d=>{d.members.forEach(o=>e.add(o.residentId))}),this.data.residents.filter(d=>!e.has(d.residentId))}ngAfterViewInit(){this.initMap()}ngOnDestroy(){this.map&&(this.map.remove(),this.map=null),this.marker=null}getAvailableResidentsForMember(e){let d=this.selectedHeadResidentId;return this.availableResidents.filter(o=>o.id!==d&&!this.additionalMembers.some((l,s)=>s!==e&&l.residentId===o.id))}addMemberRow(){this.additionalMembers.push({residentId:"",relationship:""})}removeMemberRow(e){this.additionalMembers.splice(e,1)}submit(){if(!this.household.address||!this.household.purok||!this.selectedHeadResidentId){this.error="Please fill in all required fields (Address, Purok, Head of Household)";return}let e=this.data.residents.find(h=>h.id===this.selectedHeadResidentId);if(!e){this.error="Selected head of household not found";return}let d=this.data.households.map(h=>{let c=h.householdId.match(/HH-(\d+)/);return c?parseInt(c[1]):0}),l=(d.length>0?Math.max(...d):0)+1,s=`HH-${String(l).padStart(3,"0")}`,ee=`h${this.data.households.length+1}`,E=[{residentId:e.residentId,name:e.name,age:e.age,gender:e.gender,relationship:"Head",birthdate:e.birthdate,civilStatus:e.civilStatus}];for(let h of this.additionalMembers){if(!h.residentId||!h.relationship)continue;let c=this.data.getResidentById(h.residentId);c&&E.push({residentId:c.residentId,name:c.name,age:c.age,gender:c.gender,relationship:h.relationship,birthdate:c.birthdate,civilStatus:c.civilStatus})}let te={id:ee,householdId:s,headId:this.selectedHeadResidentId,address:this.household.address,purok:this.household.purok,latitude:this.latitude??null,longitude:this.longitude??null,members:E};this.data.addHousehold(te),this.submitted=!0,this.error="",setTimeout(()=>{this.router.navigate(["/staff/households"])},1500)}reset(){this.household={address:"",purok:"",headId:""},this.selectedHeadResidentId="",this.additionalMembers=[],this.submitted=!1,this.error="",this.clearLocation()}initMap(){this.map||(this.map=C.map("add-household-map",{center:this.defaultCenter,zoom:this.defaultZoom}),C.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(this.map),this.map.on("click",e=>this.onMapClick(e)),setTimeout(()=>{this.map?.invalidateSize()},0))}onMapClick(e){this.latitude=e.latlng.lat,this.longitude=e.latlng.lng,this.updateMarker()}updateMarker(){if(!this.map||this.latitude==null||this.longitude==null)return;let e=[this.latitude,this.longitude];this.marker?this.marker.setLatLng(e):this.marker=C.circleMarker(e,{radius:8,weight:2,color:"#2563eb",fillColor:"#3b82f6",fillOpacity:.9}).addTo(this.map),this.map.setView(e,this.defaultZoom)}clearLocation(){this.latitude=null,this.longitude=null,this.map&&this.marker&&this.map.removeLayer(this.marker),this.marker=null}static{this.\u0275fac=function(d){return new(d||r)(O(B),O(W))}}static{this.\u0275cmp=R({type:r,selectors:[["app-add-household"]],decls:70,vars:8,consts:[[1,"add-household"],[1,"page-header"],[1,"page-title"],["routerLink","/staff/households",1,"btn","btn--outline","back-button"],[1,"form-card","card"],[3,"ngSubmit"],[1,"form-section"],[1,"section-title"],[1,"form-group"],["for","address"],[1,"required"],["id","address","name","address","rows","3","placeholder","Enter complete address","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-row"],["for","purok"],["id","purok","name","purok","required","",1,"form-control",3,"ngModelChange","ngModel"],["value",""],["value","Purok 1"],["value","Purok 2"],["value","Purok 3"],[1,"help-text"],[1,"household-location-map-wrapper"],["id","add-household-map","aria-label","Set household location on map",1,"household-location-map"],["class","household-location-coords",4,"ngIf"],["for","headResident"],["id","headResident","name","headResident","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],[1,"help-text",2,"margin-top","0.5rem","color","var(--color-text-muted)","font-size","0.875rem"],[1,"help-text",2,"margin-bottom","1rem"],[1,"member-row"],["type","button",1,"btn","btn--outline","btn--sm",3,"click"],[1,"error-msg"],[1,"success-msg"],[1,"form-actions"],["type","button",1,"btn","btn--outline",3,"click"],["type","submit",1,"btn","btn--primary",3,"disabled"],[1,"household-location-coords"],["routerLink","/staff/residents/add"],[1,"form-group","member-resident"],[1,"form-control",3,"ngModelChange","ngModel","name"],[1,"form-group","member-relationship"],[1,"form-group","member-actions"],["type","button","title","Remove member",1,"btn","btn--outline","btn--sm",3,"click"]],template:function(d,o){d&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),i(3,"Add New Household"),n(),t(4,"a",3),i(5,"\u2190 Back to Households List"),n()(),t(6,"div",4)(7,"form",5),p("ngSubmit",function(){return o.submit()}),t(8,"div",6)(9,"h2",7),i(10,"Household Information"),n(),t(11,"div",8)(12,"label",9),i(13,"Address "),t(14,"span",10),i(15,"*"),n()(),t(16,"textarea",11),b("ngModelChange",function(s){return _(o.household.address,s)||(o.household.address=s),s}),n()(),t(17,"div",12)(18,"div",8)(19,"label",13),i(20,"Purok "),t(21,"span",10),i(22,"*"),n()(),t(23,"select",14),b("ngModelChange",function(s){return _(o.household.purok,s)||(o.household.purok=s),s}),t(24,"option",15),i(25,"Select purok"),n(),t(26,"option",16),i(27,"Purok 1"),n(),t(28,"option",17),i(29,"Purok 2"),n(),t(30,"option",18),i(31,"Purok 3"),n()()()()(),t(32,"div",6)(33,"h2",7),i(34,"Location on Map (optional)"),n(),t(35,"p",19),i(36," Click on the map to set this household's approximate location. This will be used in the Household Map view. "),n(),t(37,"div",20),F(38,"div",21),n(),A(39,ie,7,2,"div",22),n(),t(40,"div",6)(41,"h2",7),i(42,"Head of Household"),n(),t(43,"div",8)(44,"label",23),i(45,"Select Head of Household "),t(46,"span",10),i(47,"*"),n()(),t(48,"select",24),b("ngModelChange",function(s){return _(o.selectedHeadResidentId,s)||(o.selectedHeadResidentId=s),s}),t(49,"option",15),i(50,"Select a resident"),n(),v(51,re,2,5,"option",25,Y),n(),w(53,de,5,0,"p",26),n()(),t(54,"div",6)(55,"h2",7),i(56,"Additional Household Members"),n(),t(57,"p",27),i(58,"Add other family members (sister, brother, father, mother, etc.). Optional."),n(),v(59,se,22,4,"div",28,T),t(61,"button",29),p("click",function(){return o.addMemberRow()}),i(62,"+ Add member"),n()(),w(63,me,2,1,"div",30),w(64,ce,2,0,"div",31),t(65,"div",32)(66,"button",33),p("click",function(){return o.reset()}),i(67,"Reset Form"),n(),t(68,"button",34),i(69,"Add Household"),n()()()()()),d&2&&(a(16),f("ngModel",o.household.address),a(7),f("ngModel",o.household.purok),a(16),u("ngIf",o.latitude!==null&&o.longitude!==null),a(9),f("ngModel",o.selectedHeadResidentId),a(3),S(o.availableResidents),a(2),P(o.availableResidents.length===0?53:-1),a(6),S(o.additionalMembers),a(4),P(o.error?63:-1),a(),P(o.submitted?64:-1),a(4),u("disabled",o.submitted||o.availableResidents.length===0))},dependencies:[V,N,X,$,K,Q,q,J,D,j,U,G,Z,z],styles:[".add-household[_ngcontent-%COMP%]{width:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600}.back-button[_ngcontent-%COMP%]{position:fixed;top:1.5rem;right:1.5rem;z-index:100}.form-card[_ngcontent-%COMP%]{max-width:900px;margin:0 auto}.form-section[_ngcontent-%COMP%]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid var(--color-border)}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none;margin-bottom:0;padding-bottom:0}.form-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin:0 0 1.25rem;color:var(--color-text)}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}@media(max-width:768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.member-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr auto;gap:1rem;align-items:end;margin-bottom:1rem}.member-row[_ngcontent-%COMP%]   .member-resident[_ngcontent-%COMP%], .member-row[_ngcontent-%COMP%]   .member-relationship[_ngcontent-%COMP%]{margin-bottom:0;min-width:0}.member-row[_ngcontent-%COMP%]   .member-actions[_ngcontent-%COMP%]{margin-bottom:0}.member-row[_ngcontent-%COMP%]   .member-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{white-space:nowrap}@media(max-width:768px){.member-row[_ngcontent-%COMP%]{grid-template-columns:1fr;align-items:stretch}.member-row[_ngcontent-%COMP%]   .member-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:6px;color:var(--color-text)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#dc2626}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:10px 14px;border:1px solid var(--color-border);border-radius:var(--radius);background:var(--color-bg-card);font-size:1rem}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px #2563eb26}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:var(--color-text-muted)}.form-group[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.error-msg[_ngcontent-%COMP%]{padding:12px 16px;background:#fef2f2;border:1px solid #fecaca;border-radius:var(--radius);color:#dc2626;margin-bottom:1rem;font-size:.9375rem}.success-msg[_ngcontent-%COMP%]{padding:12px 16px;background:var(--color-success-bg);border:1px solid var(--color-success);border-radius:var(--radius);color:var(--color-success);margin-bottom:1rem;font-weight:500;font-size:.9375rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--color-border)}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.help-text[_ngcontent-%COMP%]{margin-top:.5rem;color:var(--color-text-muted);font-size:.875rem}.help-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--color-primary);text-decoration:underline}.household-location-map-wrapper[_ngcontent-%COMP%]{margin-top:.75rem;border-radius:var(--radius-lg);overflow:hidden;border:1px solid var(--color-border)}.household-location-map[_ngcontent-%COMP%]{width:100%;height:320px}.household-location-coords[_ngcontent-%COMP%]{margin-top:.75rem;display:flex;flex-wrap:wrap;gap:.75rem;align-items:center}.household-location-coords[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-muted)}"]})}}return r})();export{xe as AddHouseholdComponent};
