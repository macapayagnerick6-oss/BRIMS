import{a as ee}from"./chunk-EYL5QPK3.js";import{b as z,c as q,d as D,e as j,f as Z,g as G,i as $,j as J,k as K,n as Q,o as U}from"./chunk-KYS23DP7.js";import{c as F,e as A,f as W}from"./chunk-BRLNKSN4.js";import"./chunk-KPGMZ2XY.js";import{c as N}from"./chunk-DUWH3AKD.js";import{$a as o,Ea as M,Ia as E,Na as I,Rb as L,Ta as w,Ua as S,Va as H,Vb as B,Wa as R,X as h,Xa as C,Y as u,Ya as v,Za as p,_a as i,ab as T,bb as P,cb as g,d as Y,db as c,lb as n,mb as k,nb as O,pb as y,qb as _,rb as f,sb as b,vb as V,xa as s}from"./chunk-PQPYQFLK.js";var x=Y(ee());var te=r=>["/staff/households",r],X=(r,m)=>m.id;function ie(r,m){if(r&1){let e=P();i(0,"div",37)(1,"span"),n(2),o(),i(3,"span"),n(4),o(),i(5,"button",31),g("click",function(){h(e);let t=c(2);return u(t.clearLocation())}),n(6," Clear location "),o()()}if(r&2){let e=c(2);s(2),O("Lat: ",e.latitude),s(2),O("Lng: ",e.longitude)}}function oe(r,m){if(r&1&&(i(0,"option",27),n(1),o()),r&2){let e=m.$implicit;p("value",e.id),s(),y(" ",e.residentId," - ",e.name," (",e.age,", ",e.gender,") ")}}function ne(r,m){r&1&&(i(0,"p",28),n(1," No available residents. All residents are already assigned to other households. "),o())}function re(r,m){if(r&1&&(i(0,"option",27),n(1),o()),r&2){let e=m.$implicit;p("value",e.id),s(),y(" ",e.residentId," - ",e.name," (",e.age,", ",e.gender,") ")}}function de(r,m){if(r&1&&(i(0,"option",27),n(1),o()),r&2){let e=m.$implicit;p("value",e),s(),k(e)}}function ae(r,m){if(r&1){let e=P();i(0,"div",30)(1,"div",38)(2,"label"),n(3,"Resident"),o(),i(4,"select",39),b("ngModelChange",function(t){let a=h(e).$implicit;return f(a.residentId,t)||(a.residentId=t),u(t)}),i(5,"option",17),n(6,"Select resident"),o(),C(7,re,2,5,"option",27,X),o()(),i(9,"div",40)(10,"label"),n(11,"Relationship"),o(),i(12,"select",39),b("ngModelChange",function(t){let a=h(e).$implicit;return f(a.relationship,t)||(a.relationship=t),u(t)}),i(13,"option",17),n(14,"Select relationship"),o(),C(15,de,2,2,"option",27,R),o()(),i(17,"div",41)(18,"label"),n(19,"\xA0"),o(),i(20,"button",42),g("click",function(){let t=h(e).$index,a=c(2);return u(a.removeMemberRow(t))}),n(21,"Remove"),o()()()}if(r&2){let e=m.$implicit,d=m.$index,t=c(2);s(4),_("ngModel",e.residentId),p("name","memberResident"+d),s(3),v(t.getAvailableResidentsForMember(d)),s(5),_("ngModel",e.relationship),p("name","memberRelationship"+d),s(3),v(t.RELATIONSHIP_OPTIONS)}}function se(r,m){if(r&1&&(i(0,"div",32),n(1),o()),r&2){let e=c(2);s(),k(e.error)}}function le(r,m){r&1&&(i(0,"div",33),n(1,"Household updated successfully! Redirecting to household details..."),o())}function me(r,m){if(r&1){let e=P();i(0,"div",2)(1,"div",3)(2,"h1",4),n(3,"Edit Household"),o(),i(4,"a",5),n(5,"\u2190 Back to Household Details"),o()(),i(6,"div",6)(7,"form",7),g("ngSubmit",function(){h(e);let t=c();return u(t.submit())}),i(8,"div",8)(9,"h2",9),n(10,"Household Information"),o(),i(11,"div",10)(12,"label",11),n(13,"Address "),i(14,"span",12),n(15,"*"),o()(),i(16,"textarea",13),b("ngModelChange",function(t){h(e);let a=c();return f(a.address,t)||(a.address=t),u(t)}),o()(),i(17,"div",14)(18,"div",10)(19,"label",15),n(20,"Purok "),i(21,"span",12),n(22,"*"),o()(),i(23,"select",16),b("ngModelChange",function(t){h(e);let a=c();return f(a.purok,t)||(a.purok=t),u(t)}),i(24,"option",17),n(25,"Select purok"),o(),i(26,"option",18),n(27,"Purok 1"),o(),i(28,"option",19),n(29,"Purok 2"),o(),i(30,"option",20),n(31,"Purok 3"),o()()()()(),i(32,"div",8)(33,"h2",9),n(34,"Location on Map (optional)"),o(),i(35,"p",21),n(36," Click on the map to update this household's approximate location. This will be used in the Household Map view. "),o(),i(37,"div",22),T(38,"div",23),o(),I(39,ie,7,2,"div",24),o(),i(40,"div",8)(41,"h2",9),n(42,"Head of Household"),o(),i(43,"div",10)(44,"label",25),n(45,"Select Head of Household "),i(46,"span",12),n(47,"*"),o()(),i(48,"select",26),b("ngModelChange",function(t){h(e);let a=c();return f(a.selectedHeadResidentId,t)||(a.selectedHeadResidentId=t),u(t)}),i(49,"option",17),n(50,"Select a resident"),o(),C(51,oe,2,5,"option",27,X),o(),w(53,ne,2,0,"p",28),o()(),i(54,"div",8)(55,"h2",9),n(56,"Additional Household Members"),o(),i(57,"p",29),n(58,"Add other family members (sister, brother, father, mother, etc.). Optional."),o(),C(59,ae,22,4,"div",30,H),i(61,"button",31),g("click",function(){h(e);let t=c();return u(t.addMemberRow())}),n(62,"+ Add member"),o()(),w(63,se,2,1,"div",32),w(64,le,2,0,"div",33),i(65,"div",34)(66,"button",35),g("click",function(){h(e);let t=c();return u(t.reset())}),n(67,"Reset Form"),o(),i(68,"button",36),n(69,"Save Changes"),o()()()()()}if(r&2){let e=c();s(4),p("routerLink",V(9,te,e.household.id)),s(12),_("ngModel",e.address),s(7),_("ngModel",e.purok),s(16),p("ngIf",e.latitude!==null&&e.longitude!==null),s(9),_("ngModel",e.selectedHeadResidentId),s(3),v(e.availableResidents),s(2),S(e.availableResidents.length===0?53:-1),s(6),v(e.additionalMembers),s(4),S(e.error?63:-1),s(),S(e.submitted?64:-1),s(4),p("disabled",e.submitted||e.availableResidents.length===0)}}function ce(r,m){r&1&&(i(0,"div",43)(1,"p"),n(2,"Household not found. "),i(3,"a",44),n(4,"Back to Households"),o()()())}var ve=(()=>{class r{constructor(e,d,t){this.route=e,this.router=d,this.data=t,this.householdId="",this.address="",this.purok="",this.selectedHeadResidentId="",this.additionalMembers=[],this.submitted=!1,this.error="",this.latitude=null,this.longitude=null,this.map=null,this.marker=null,this.defaultCenter=[8.574,124.776],this.defaultZoom=17,this.RELATIONSHIP_OPTIONS=["Spouse","Father","Mother","Son","Daughter","Brother","Sister","Grandfather","Grandmother","Other"]}ngOnInit(){this.route.paramMap.subscribe(e=>{let d=e.get("id");if(d&&(this.householdId=d,this.household=this.data.getHouseholdById(d),this.household)){this.address=this.household.address,this.purok=this.household.purok,this.latitude=this.household.latitude??null,this.longitude=this.household.longitude??null;let t=this.household.members.find(l=>l.relationship==="Head");if(t){let l=this.data.getResidentByResidentId(t.residentId);this.selectedHeadResidentId=l?.id??""}let a=this.household.members.filter(l=>l.relationship!=="Head");this.additionalMembers=a.map(l=>({residentId:this.data.getResidentByResidentId(l.residentId)?.id??"",relationship:l.relationship})),this.additionalMembers.length===0&&(this.additionalMembers=[{residentId:"",relationship:""}])}})}ngAfterViewInit(){this.initMap(),this.updateMarker()}ngOnDestroy(){this.map&&(this.map.remove(),this.map=null),this.marker=null}get availableResidents(){return this.data.residents.filter(e=>!this.data.households.some(t=>t.id!==this.householdId&&t.members.some(a=>a.residentId===e.residentId)))}getAvailableResidentsForMember(e){let d=this.selectedHeadResidentId;return this.availableResidents.filter(t=>t.id!==d&&!this.additionalMembers.some((a,l)=>l!==e&&a.residentId===t.id))}addMemberRow(){this.additionalMembers.push({residentId:"",relationship:""})}removeMemberRow(e){this.additionalMembers.splice(e,1)}submit(){if(!this.household)return;if(!this.address?.trim()||!this.purok||!this.selectedHeadResidentId){this.error="Please fill in all required fields (Address, Purok, Head of Household)";return}let e=this.data.getResidentById(this.selectedHeadResidentId);if(!e){this.error="Selected head of household not found";return}let t=[{residentId:e.residentId,name:e.name,age:e.age,gender:e.gender,relationship:"Head",birthdate:e.birthdate,civilStatus:e.civilStatus}];for(let a of this.additionalMembers){if(!a.residentId||!a.relationship)continue;let l=this.data.getResidentById(a.residentId);l&&t.push({residentId:l.residentId,name:l.name,age:l.age,gender:l.gender,relationship:a.relationship,birthdate:l.birthdate,civilStatus:l.civilStatus})}this.data.updateHousehold(this.householdId,{address:this.address.trim(),purok:this.purok,headId:this.selectedHeadResidentId,members:t,latitude:this.latitude??null,longitude:this.longitude??null}),this.submitted=!0,this.error="",setTimeout(()=>{this.router.navigate(["/staff/households",this.householdId])},1500)}reset(){if(this.household){this.address=this.household.address,this.purok=this.household.purok;let e=this.household.members.find(t=>t.relationship==="Head");if(e){let t=this.data.getResidentByResidentId(e.residentId);this.selectedHeadResidentId=t?.id??""}let d=this.household.members.filter(t=>t.relationship!=="Head");this.additionalMembers=d.map(t=>({residentId:this.data.getResidentByResidentId(t.residentId)?.id??"",relationship:t.relationship})),this.additionalMembers.length===0&&(this.additionalMembers=[{residentId:"",relationship:""}])}this.submitted=!1,this.error="",this.household?(this.latitude=this.household.latitude??null,this.longitude=this.household.longitude??null):(this.latitude=null,this.longitude=null),this.updateMarker()}initMap(){this.map||(this.map=x.map("edit-household-map",{center:this.defaultCenter,zoom:this.defaultZoom}),x.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(this.map),this.map.on("click",e=>this.onMapClick(e)),setTimeout(()=>{this.map?.invalidateSize(),this.updateMarker()},0))}onMapClick(e){this.latitude=e.latlng.lat,this.longitude=e.latlng.lng,this.updateMarker()}updateMarker(){if(!this.map)return;if(this.latitude==null||this.longitude==null){this.marker&&(this.map.removeLayer(this.marker),this.marker=null),this.map.setView(this.defaultCenter,this.defaultZoom);return}let e=[this.latitude,this.longitude];this.marker?this.marker.setLatLng(e):this.marker=x.circleMarker(e,{radius:8,weight:2,color:"#2563eb",fillColor:"#3b82f6",fillOpacity:.9}).addTo(this.map),this.map.setView(e,this.defaultZoom)}clearLocation(){this.latitude=null,this.longitude=null,this.map&&this.marker&&this.map.removeLayer(this.marker),this.marker=null}static{this.\u0275fac=function(d){return new(d||r)(M(F),M(A),M(N))}}static{this.\u0275cmp=E({type:r,selectors:[["app-edit-household"]],decls:2,vars:2,consts:[["class","edit-household",4,"ngIf"],["class","card",4,"ngIf"],[1,"edit-household"],[1,"page-header"],[1,"page-title"],[1,"btn","btn--outline","back-link-corner",3,"routerLink"],[1,"form-card","card"],[3,"ngSubmit"],[1,"form-section"],[1,"section-title"],[1,"form-group"],["for","address"],[1,"required"],["id","address","name","address","rows","3","placeholder","Enter complete address","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-row"],["for","purok"],["id","purok","name","purok","required","",1,"form-control",3,"ngModelChange","ngModel"],["value",""],["value","Purok 1"],["value","Purok 2"],["value","Purok 3"],[1,"help-text"],[1,"household-location-map-wrapper"],["id","edit-household-map","aria-label","Set household location on map",1,"household-location-map"],["class","household-location-coords",4,"ngIf"],["for","headResident"],["id","headResident","name","headResident","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],[1,"help-text",2,"margin-top","0.5rem","color","var(--color-text-muted)","font-size","0.875rem"],[1,"help-text",2,"margin-bottom","1rem"],[1,"member-row"],["type","button",1,"btn","btn--outline","btn--sm",3,"click"],[1,"error-msg"],[1,"success-msg"],[1,"form-actions"],["type","button",1,"btn","btn--outline",3,"click"],["type","submit",1,"btn","btn--primary",3,"disabled"],[1,"household-location-coords"],[1,"form-group","member-resident"],[1,"form-control",3,"ngModelChange","ngModel","name"],[1,"form-group","member-relationship"],[1,"form-group","member-actions"],["type","button","title","Remove member",1,"btn","btn--outline","btn--sm",3,"click"],[1,"card"],["routerLink","/staff/households"]],template:function(d,t){d&1&&I(0,me,70,11,"div",0)(1,ce,5,0,"div",1),d&2&&(p("ngIf",t.household),s(),p("ngIf",!t.household&&t.householdId))},dependencies:[B,L,U,G,J,K,z,$,q,D,Q,Z,j,W],styles:[".edit-household[_ngcontent-%COMP%]{width:100%;position:relative}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600}.edit-household[_ngcontent-%COMP%]   .back-link-corner[_ngcontent-%COMP%]{position:absolute;top:16px;right:24px}@media(max-width:640px){.edit-household[_ngcontent-%COMP%]   .back-link-corner[_ngcontent-%COMP%]{top:12px;right:16px}}.form-card[_ngcontent-%COMP%]{max-width:900px;margin:0 auto}.form-section[_ngcontent-%COMP%]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid var(--color-border)}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none;margin-bottom:0;padding-bottom:0}.form-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin:0 0 1.25rem;color:var(--color-text)}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}@media(max-width:768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.member-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr auto;gap:1rem;align-items:end;margin-bottom:1rem}.member-row[_ngcontent-%COMP%]   .member-resident[_ngcontent-%COMP%], .member-row[_ngcontent-%COMP%]   .member-relationship[_ngcontent-%COMP%]{margin-bottom:0;min-width:0}.member-row[_ngcontent-%COMP%]   .member-actions[_ngcontent-%COMP%]{margin-bottom:0}.member-row[_ngcontent-%COMP%]   .member-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{white-space:nowrap}@media(max-width:768px){.member-row[_ngcontent-%COMP%]{grid-template-columns:1fr;align-items:stretch}.member-row[_ngcontent-%COMP%]   .member-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:6px;color:var(--color-text)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#dc2626}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:10px 14px;border:1px solid var(--color-border);border-radius:var(--radius);background:var(--color-bg-card);font-size:1rem}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px #2563eb26}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:var(--color-text-muted)}.form-group[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.error-msg[_ngcontent-%COMP%]{padding:12px 16px;background:#fef2f2;border:1px solid #fecaca;border-radius:var(--radius);color:#dc2626;margin-bottom:1rem;font-size:.9375rem}.success-msg[_ngcontent-%COMP%]{padding:12px 16px;background:var(--color-success-bg);border:1px solid var(--color-success);border-radius:var(--radius);color:var(--color-success);margin-bottom:1rem;font-weight:500;font-size:.9375rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--color-border)}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.help-text[_ngcontent-%COMP%]{margin-top:.5rem;color:var(--color-text-muted);font-size:.875rem}.help-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--color-primary);text-decoration:underline}.household-location-map-wrapper[_ngcontent-%COMP%]{margin-top:.75rem;border-radius:var(--radius-lg);overflow:hidden;border:1px solid var(--color-border)}.household-location-map[_ngcontent-%COMP%]{width:100%;height:320px}.household-location-coords[_ngcontent-%COMP%]{margin-top:.75rem;display:flex;flex-wrap:wrap;gap:.75rem;align-items:center}.household-location-coords[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-muted)}"]})}}return r})();export{ve as EditHouseholdComponent};
